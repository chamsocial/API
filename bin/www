#!/usr/bin/env node

/**
 * Module dependencies.
 */
const app = require('../app')
const graphqlServer = require('../routes/graphql')


/**
 * Get port from environment and store in Express.
 */
function normalizePort(val) {
  const portNr = Number(val)
  if (Number.isNaN(portNr)) return val
  if (portNr >= 0) return portNr
  return false
}
const port = normalizePort(process.env.PORT || '7440')


async function main() {
  await graphqlServer(app)

  await new Promise((res, rej) => {
    const s = app.listen(port, err => (err ? rej(err) : res(s)))
  })

  console.log(' ⚡️ Express running on port:', port)
}


main()
  .then(() => console.log('--- All started'))
  .catch(error => {
    console.log('STARTUP_ERROR', error)
    process.exit(1)
  })
